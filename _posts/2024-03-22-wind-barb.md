---
author: Dan Kelley
date: 2024-03-22
title: Drawing Wind Barbs with the oce R Package
---

# Introduction

Recently, an oce user named Max Dupilka asked (see
[https://github.com/dankelley/oce/issues/2191](https://github.com/dankelley/oce/issues/2191))
whether oce could draw "wind-barb" diagrams.  This struck me an oce co-author
Clark Richards as a good idea.  So, with a *lot* of help from Max, I added this
feature.

The feature will soon be inserted into the existing `mapDrawDirectionField()`
function, but for a week or so it will reside in a temporary function named
`mapDrawDirectionFieldNEW()`.  (I will alter this blog item when I make this
switch.)

In this blog entry, I'll show how to use this function.  First, though, you'll
need to see how to update your version of oce to the development version.

# Gaining Access to the oce Update

This may not appear in CRAN for a few months, given CRAN policies on updates to
packages.  But, if you have a system that is set up to build R packages from
source (which requires C, C++ and Fortran compilers), you can install the
update by typing the following in an R session.  (Install the `remotes` package
first, if you don't have it already.)

```R
remotes::install_github("dankelley/oce", ref = "develop")
```

# An Idealized Example

![wind barbs](/dek_blog/docs/assets/images/2024-03-22-wind-barb.png)

The diagram given above is an example. What I have done here is to imagine a
Gaussian-shaped low-pressure zone centred over the southern part of Hudson's
Bay (visible as the red dot on the top axis of the plot).  Winds are computed
using geostrophic formulae.

As you can see from the code at the bottom of this post, I constructed a fairly
dense grid of longitudes and latitudes in my simulation, so that the contours
of pressure (red) would be smooth. But if I drew barbs for each of those
points, the page would be a mass of black ink, so I sub-sampled the wind data
for the barbs.  My method for doing that might be of use to some readers.

Here's how to read this sort of diagram.  From each longitude and latitude
point where there is an observation or model prediction, draw a line segment
that points upwind, and that covers a fixed distance over the ground. Then
round the speed to the nearest multiple of 5 knots. (Conversion: 1 m/s equals
1.94384 knots.)

If the speed is nonzero, but rounds to 0, the segment is not adorned.  If the
speed rounds to 5 knots, a single short barb is drawn near the end of the main
segment. You can see one of these, extending from the southern edge of
Newfoundland. If the speed rounds to 10 knots, draw a long barb at the end. For
higher speeds, continue to add long or short barbs, with the long ones at the
end and short ones nearer the origin. For example, the long and short barb for
winds near Cape Breton indicate a speed of 15 knots. This pattern continues
until 50 knots is reached.  For 50 knots, draw a triangle, called a pennant.
You can see some pennants at towards the northeast of the diagram, where lines
of constant pressure are closest together.

In summary, just add up 5 knots for each short barb, 10 for each normal barb,
and 50 for each pennant.


# Using Other Units

I have seen displays use km/hour instead of knots, but retain the 5:10:50
scheme for short barbs, normal barbs, and pennants.  Of course, it is easy to
use `mapDirectionFieldNEW()` to accomodate this or any other 5:10:50 scheme,
simply by using a multiplier on velocity.

If your interest is in wind stress, consider using stress instead of velocity.
For example, a rough value for wind speed over the North Atlantic is 10m/s.
Using air density 1.2 kg/m^3 with a quadratic drag coefficient of 0.002 (say),
this yields a stress of 0.24 Pa. This might suggest using short barbs could be
used for stress increments of 0.1 Pa, normal barbs for 0.2 Pa, and pennants for
0.5 Pa.




# R Code to Make the Example

```R
library(oce)
data(coastlineWorldFine, package = "ocedata")
par(mar = rep(2, 4))
mapPlot(coastlineWorldFine,
    border = gray(0.7),
    col = grey(0.95),
    projection = "+proj=lcc +lat_1=40 +lat_2=60 +lon_0=-65",
    longitudelim = c(-80, -50), latitudelim = c(40, 50)
)
# fake a geostrophic wind field centred in lower Hudson's Bay
model <- function(x, y, latitude, R = 100e3, rho = 1.2,
                  highP = 101.5e3, lowP = 98e3) {
    E <- exp(-(x^2 + y^2) / R^2)
    deltaP <- highP - lowP
    P <- highP - deltaP * E
    dPdx <- 2 * deltaP * x / R^2 * E
    dPdy <- 2 * deltaP * y / R^2 * E
    f <- oce::coriolis(latitude)
    u <- -dPdy / rho / f
    v <- dPdx / rho / f
    list(P = P, dPdx = dPdx, dPdy = dPdy, u = u, v = v)
}

nlon <- 50
nlat <- nlon + 1
lon <- seq(-100, -30, length.out = nlon)
lat <- seq(30, 60, length.out = nlat)
g <- expand.grid(lon = lon, lat = lat)
xy <- lonlat2map(g$lon, g$lat)
xyc <- lonlat2map(-81.30, 53.01) # Akimiski Island (Hudson's Bay)
m <- model(xy$x - xyc$x, xy$y - xyc$y, latitude = g$lat, R = 1000e3, lowP = 97e3, highP = 101e3)
mps2knot <- 1.94384 # 1 m/s is 1.94384 knots
u <- mps2knot * matrix(m$u, nrow = length(lon))
v <- mps2knot * matrix(m$v, nrow = length(lon))
P <- matrix(m$P, nrow = length(lon))
mapContour(lon, lat, P, drawlabels = FALSE, col = 2, lwd = 1)
lx <- seq(1, length(lon), 4)
ly <- seq(1, length(lat), 4)
mapDirectionFieldNEW(lon[lx], lat[ly], u[lx, ly], v[lx, ly],
    lwd = 1.4,
    code = "barb", scale = 2, length = 0.25
)
points(xyc$x, xyc$y, pch = 20, cex = 3, col = 2)
```
