---
author: Dan Kelley
date: 2024-03-07
title: Demonstration of the Updated mapImage Function in oce
---

I have been making some changes to the oce function `mapImage()` lately, to
address an issue kindly pointed out by a user on github^[1:]. The problem is
that the image can have missing values at certain points, depending on the
projection being used, the geographical domain being shown, and the data grid
being plotted.

I won't get into details here.  I just want to illustrate the problem
and some solutions. This requires the very latest version of the
development branch of the oce code, as it will exist in perhaps a few
days or weeks, once the issue is closed.

At the bottom of this post I have sample code.  Notice that it has four
alternatives for the `mapImage()` call.  The results from those alternatives
are pasted below.

**Method 1: using polygons, not filled contours.**

![01.png](/dek_blog/docs/assets/images/2024-03-07-mapimage-1.png)

**Method 2: using filled contours, yielding gaps.**

![02.png](/dek_blog/docs/assets/images/2024-03-07-mapimage-2.png)

**Method 3: using filled contours, with larger grid cells to fill gaps.**

![03.png](/dek_blog/docs/assets/images/2024-03-07-mapimage-3.png)

**Method 4: using filled contours, with a gridder that fills gaps.**

![04.png](/dek_blog/docs/assets/images/2024-03-07-mapimage-4.png)


**Footnotes**

[1:] [https://github.com/dankelley/oce/issues/2199](https://github.com/dankelley/oce/issues/2199)

**Code**

The images are made by uncommenting the various `mapImage()` blocks.

```R
library(oce)
data(coastlineWorld)
data(topoWorld)

# Northern polar region, with color-coded bathymetry
par(mfrow = c(1, 1), mar = c(2, 2, 1, 1))
cm <- colormap(zlim = c(-5000, 0), col = oceColorsGebco)
drawPalette(colormap = cm)
mapPlot(coastlineWorld,
    projection = "+proj=stere +lat_0=90",
    longitudelim = c(-180, 180), latitudelim = c(70, 110)
)

# Method 1: the default, using polygons for lon-lat patches
mapImage(topoWorld, colormap = cm)

# Method 2: filled contours, with ugly missing-data traces
# mapImage(topoWorld, colormap = cm, filledContour = TRUE)

# Method 3: filled contours, with a double-sized grid cells
# mapImage(topoWorld, colormap = cm, filledContour = 2)

# Method 4: filled contours, with a gap-filling gridder)
# g <- function(...) binMean2D(..., fill = TRUE, fillgap = 2)
# mapImage(topoWorld, colormap = cm, filledContour = TRUE, gridder = g)


mapGrid(15, 15, polarCircle = 1, col = gray(0.2))
mapPolygon(coastlineWorld[["longitude"]],
    coastlineWorld[["latitude"]],
    col = "tan"
)
```
